<VirtualHost *:80>
    ServerName yourdomain.com
    ServerAlias www.yourdomain.com
    DocumentRoot /var/www/html/comm
    
    # Security headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "no-referrer-when-downgrade"
    Header always set Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'"
    
    # Hide Apache version
    ServerTokens Prod
    ServerSignature Off
    
    # Directory configuration
    <Directory /var/www/html/comm>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted
        
        # PHP settings
        php_value upload_max_filesize 100M
        php_value post_max_size 100M
        php_value max_execution_time 300
        php_value memory_limit 256M
    </Directory>
    
    # Deny access to sensitive directories
    <Directory /var/www/html/comm/config>
        Require all denied
    </Directory>
    
    <Directory /var/www/html/comm/antibot>
        Require all denied
    </Directory>
    
    <Directory /var/www/html/comm/prevents>
        Require all denied
    </Directory>
    
    # Allow uploads directory
    <Directory /var/www/html/comm/views/xentryxupload>
        Options -Indexes
        AllowOverride None
        Require all granted
    </Directory>
    
    # Deny access to sensitive files
    <FilesMatch "\.(bak|backup|old|tmp|temp|log|ini|conf)$">
        Require all denied
    </FilesMatch>
    
    <FilesMatch "^\.">
        Require all denied
    </FilesMatch>
    
    # Static files caching
    <LocationMatch "\.(jpg|jpeg|png|gif|ico|css|js|pdf|txt)$">
        ExpiresActive On
        ExpiresDefault "access plus 1 year"
        Header append Cache-Control "public"
    </LocationMatch>
    
    # Error and access logs
    ErrorLog ${APACHE_LOG_DIR}/comm_error.log
    CustomLog ${APACHE_LOG_DIR}/comm_access.log combined
    
    # Log level
    LogLevel warn
</VirtualHost>

# HTTPS redirect (uncomment after SSL setup)
# <VirtualHost *:80>
#     ServerName yourdomain.com
#     ServerAlias www.yourdomain.com
#     Redirect permanent / https://yourdomain.com/
# </VirtualHost>

# HTTPS configuration (uncomment after SSL setup)
# <VirtualHost *:443>
#     ServerName yourdomain.com
#     ServerAlias www.yourdomain.com
#     DocumentRoot /var/www/html/comm
#     
#     # SSL configuration
#     SSLEngine on
#     SSLCertificateFile /etc/letsencrypt/live/yourdomain.com/cert.pem
#     SSLCertificateKeyFile /etc/letsencrypt/live/yourdomain.com/privkey.pem
#     SSLCertificateChainFile /etc/letsencrypt/live/yourdomain.com/chain.pem
#     
#     # SSL security settings
#     SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
#     SSLCipherSuite ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305
#     SSLHonorCipherOrder off
#     SSLSessionTickets off
#     
#     # Security headers
#     Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
#     Header always set X-Frame-Options "SAMEORIGIN"
#     Header always set X-XSS-Protection "1; mode=block"
#     Header always set X-Content-Type-Options "nosniff"
#     Header always set Referrer-Policy "no-referrer-when-downgrade"
#     Header always set Content-Security-Policy "default-src 'self' https: data: blob: 'unsafe-inline'"
#     
#     # Include the same directory and file configurations as above
#     # ... (copy all Directory and FilesMatch blocks from the HTTP VirtualHost)
# </VirtualHost>
